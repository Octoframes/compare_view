import*as e from"react";var t={d:(e,c)=>{for(var n in c)t.o(c,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:c[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},c={};t.d(c,{Z:()=>q,t:()=>v});const n=(a={default:()=>e.default,useEffect:()=>e.useEffect},o={},t.d(o,a),o);var a,o,i,r;!function(e){e[void 0]="undefined",e.horizontal="horizontal",e.vertical="vertical",e.circle="circle"}(i||(i={})),function(e){e[e.none=0]="none",e[e.revolve_imgs=1]="revolve_imgs",e[e.update_imgs=2]="update_imgs",e[e.change_mode=3]="change_mode",e[e.update_circle=4]="update_circle",e[e.remove_circle=5]="remove_circle",e[e.start_slider_move=6]="start_slider_move",e[e.possible_instant_slide=7]="possible_instant_slide",e[e.update_slider=8]="update_slider"}(r||(r={}));const l={start_mode:i.circle,circumference_fraction:.005,circle_size:void 0,circle_fraction:.2,show_circle:!0,revolve_imgs_on_click:!0,slider_fraction:.01,slider_time:400,rate_function:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2},start_slider_pos:.5,show_slider:!0};function s(e,t){return null!=e[t]?e[t]:l[t]}function u(e,t){e.canvas.width=t[0],e.canvas.height=t[1],e.width=e.canvas.width,e.height=e.canvas.height,function(e){let t=Math.max(e.canvas.width,e.canvas.height);e.circumference_thickness=t*s(e.cfg,"circumference_fraction"),e.circle_size=null!=e.cfg.circle_size?e.cfg.circle_size:t*s(e.cfg,"circle_fraction"),e.slider_thickness=t*s(e.cfg,"slider_fraction")}(e)}function d(e){var t,c;let n=null===(t=e[0])||void 0===t?void 0:t.element.width,a=null===(c=e[0])||void 0===c?void 0:c.element.height;for(let t of e)t.element.width==n&&t.element.height==a||console.log("Warning: images don't have the same resolution"),n=Math.max(n,t.element.width),a=Math.max(a,t.element.height);return[n,a]}function _(e,t){if(e.length<2)throw`image_urls must contain at least two images, not ${e.length}`;let c=[],n=0,a=e.length;for(let o=0;o<a;++o){let i={url:e[o],element:document.createElement("img"),label:`${o}`};c.push(i),i.element.onload=()=>{++n,n==a&&t(c,d(c))},i.element.src=i.url}}function h(e){return e.images.unshift(e.images.pop()),!0}function m(e){return e.images=e.new_images,u(e,e.new_image_resolution),!0}function v(e,t){_(t,((t,c)=>{e.new_images=t,e.images_len=t.length,e.new_image_resolution=c,$(e,r.update_imgs)}))}function f(e){var t;if(null!=e.ctrl_data)switch((t=e.ctrl_data).circle_check.checked=!1,t.horizontal_check.checked=!1,t.vertical_check.checked=!1,e.current_mode){case i.circle:e.ctrl_data.circle_check.checked=!0;break;case i.horizontal:e.ctrl_data.horizontal_check.checked=!0;break;case i.vertical:e.ctrl_data.vertical_check.checked=!0;break;default:throw`unsupported mode: ${e.current_mode}`}}function g(e,t){return c=>{c.target.checked?(e.next_mode=t,$(e,r.change_mode)):f(e)}}function p(e,t){let c=e.canvas.getBoundingClientRect(),n=e.width/c.width,a=e.height/c.height;e.mouse_pos=[(t.clientX-c.left)*n,(t.clientY-c.top)*a]}function w(e){return e.render_circle=!0,e.canvas.style.cursor="none",!1}function k(e){return S(e,r.update_circle),e.canvas.style.cursor="default",!0}function x(e,t,c){e.ctx.beginPath(),e.ctx.arc(e.mouse_pos[0],e.mouse_pos[1],e.circle_size,t,c),c-t!=2*Math.PI&&e.ctx.lineTo(e.mouse_pos[0],e.mouse_pos[1]),e.ctx.closePath()}function b(e,t,c,n){var a;x(e,c,n),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(a=e.images[t])||void 0===a?void 0:a.element,0,0,e.width,e.height),e.ctx.restore(),e.show_circle&&(x(e,c,n),e.ctx.strokeStyle="black",e.ctx.lineWidth=e.circumference_thickness,e.ctx.stroke())}function y(e,t){return $(e,r.update_slider),e.start_timestamp=t,e.start_pos=e.slider_pos,e.current_mode==i.horizontal?e.target_pos=e.mouse_pos[0]/e.width:e.target_pos=e.mouse_pos[1]/e.height,!0}function z(e,t){return e.held_down&&(e.current_mode==i.horizontal?e.target_pos=e.mouse_pos[0]/e.width:e.target_pos=e.mouse_pos[1]/e.height,e.start_pos=e.target_pos,e.slider_pos=e.target_pos),!0}function E(e,t){let c=(t-e.start_timestamp)/e.slider_time;return c=Math.min(Math.max(c,0),1),c=e.rate_function(c),e.slider_pos=(1-c)*e.start_pos+c*e.target_pos,e.slider_pos==e.target_pos}function P(e){switch(e.current_mode){case i.undefined:break;case i.circle:!function(e){e.canvas.onmousemove=null,e.canvas.onmouseleave=null,e.canvas.ontouchstart=null,e.canvas.onmousedown=null,e.canvas.onfocus=null,e.canvas.onblur=null,e.canvas.style.cursor="default",document.body.style.userSelect="text",e.touching=!1,$(e,r.remove_circle)}(e);break;case i.horizontal:case i.vertical:!function(e){e.canvas.onmousedown=null,e.canvas.onmouseup=null,document.onmouseup=null,e.canvas.onmouseup=null,e.canvas.onmousemove=null,e.canvas.onmouseenter=null,e.canvas.onmouseleave=null,e.canvas.onfocus=null,e.canvas.onblur=null,e.held_down=!1,e.canvas.style.cursor="default",document.body.style.userSelect="text"}(e);break;default:throw`unsupported mode: ${e.current_mode}`}}function I(e){switch(e.current_mode=e.next_mode,e.next_mode){case i.circle:!function(e){e.canvas.onmousemove=t=>{p(e,t),$(e,r.update_circle)},e.canvas.onmouseleave=()=>{$(e,r.remove_circle)},e.revolve_imgs_on_click&&(e.canvas.ontouchstart=()=>{e.touching=!0},e.canvas.onmousedown=()=>{e.touching||$(e,r.revolve_imgs)}),e.canvas.matches(":hover")&&$(e,r.update_circle),e.canvas.onfocus=()=>{document.body.style.userSelect="none"},e.canvas.onblur=()=>{document.body.style.userSelect="text",e.touching=!1}}(e);break;case i.horizontal:case i.vertical:!function(e){e.canvas.onmousedown=()=>{e.held_down=!0,$(e,r.start_slider_move)},e.canvas.onmouseup=()=>{e.held_down=!1},document.onmouseup=()=>{e.held_down=!1},e.canvas.onmousemove=t=>{p(e,t),$(e,r.possible_instant_slide)},e.current_mode==i.horizontal?e.canvas.onmouseenter=()=>{e.canvas.style.cursor="ew-resize"}:e.canvas.onmouseenter=()=>{e.canvas.style.cursor="ns-resize"},e.canvas.onmouseleave=()=>{e.canvas.style.cursor="default"},e.canvas.onfocus=()=>{document.body.style.userSelect="none"},e.canvas.onblur=()=>{document.body.style.userSelect="text"}}(e);break;default:throw`unsupported mode: ${e.current_mode}`}f(e)}function R(e){return P(e),I(e),!0}function M(e,t){!function(e,t){let c=[];for(;e.task_stack.length;){let n,a=e.task_stack.pop();switch(a){case r.none:n=!0;break;case r.change_mode:n=R(e);break;case r.revolve_imgs:n=h(e);break;case r.update_imgs:n=m(e);break;case r.update_circle:n=w(e);break;case r.remove_circle:n=k(e);break;case r.start_slider_move:n=y(e,t);break;case r.possible_instant_slide:n=z(e);break;case r.update_slider:n=E(e,t);break;default:throw`unknown task: ${a}`}n||c.push(a)}e.task_stack=c}(e,t),function(e){switch(e.current_mode){case i.circle:!function(e){var t;if(e.render_circle){e.ctx.clearRect(0,0,e.width,e.height),function(e){var t;e.ctx.beginPath(),e.ctx.arc(e.mouse_pos[0],e.mouse_pos[1],e.circle_size-1,0,2*Math.PI),e.ctx.lineTo(e.width,0),e.ctx.lineTo(0,0),e.ctx.lineTo(0,e.height),e.ctx.lineTo(e.width,e.height),e.ctx.lineTo(e.width,0),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(t=e.images[0])||void 0===t?void 0:t.element,0,0,e.width,e.height),e.ctx.restore()}(e);for(let t=1;t<e.images_len;++t)b(e,t,(t-1)*Math.PI*2/(e.images_len-1),t*Math.PI*2/(e.images_len-1))}else e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(t=e.images[0])||void 0===t?void 0:t.element,0,0,e.width,e.height);e.render_circle=!1}(e);break;case i.horizontal:case i.vertical:!function(e){var t;e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(t=e.images[0])||void 0===t?void 0:t.element,0,0,e.width,e.height),e.show_slider&&function(e){e.ctx.beginPath(),e.current_mode==i.horizontal?(e.ctx.moveTo(e.slider_pos*e.width,0),e.ctx.lineTo(e.slider_pos*e.width,e.height)):(e.ctx.moveTo(0,e.slider_pos*e.height),e.ctx.lineTo(e.width,e.slider_pos*e.height)),e.ctx.closePath(),e.ctx.strokeStyle="black",e.ctx.lineWidth=e.slider_thickness,e.ctx.stroke()}(e),function(e){var t;e.ctx.beginPath(),e.current_mode==i.horizontal?e.ctx.rect(e.slider_pos*e.width,0,e.width,e.height):e.ctx.rect(0,e.slider_pos*e.height,e.width,e.height),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(t=e.images[1])||void 0===t?void 0:t.element,0,0,e.width,e.height),e.ctx.restore()}(e)}(e);break;default:throw`unsupported mode: ${e.current_mode}`}}(e),e.task_stack.length?T(e):e.next_update_queued=!1}function T(e){e.next_update_queued=!0,window.requestAnimationFrame((t=>{M(e,t)}))}function S(e,t){let c=e.task_stack.indexOf(t);-1!=c&&e.task_stack.splice(c,1)}function $(e,t){S(e,t),e.task_stack.push(t),function(e){e.next_update_queued||T(e)}(e)}const q=e=>{let t=n.default.createRef(),c=n.default.createRef(),a=n.default.createRef(),o=n.default.createRef(),l=n.default.createRef();return(0,n.useEffect)((()=>{var n;let d=null===(n=t.current)||void 0===n?void 0:n.getContext("2d");!function(e,t,c={},n){!function(e){if("y"===e.dataset.in_use)throw`the canvas with the id '${e.id}' is already in use`;e.dataset.in_use="y"}(t.canvas),_(e,((e,a)=>{let o={cfg:c,images:e,images_len:e.length,new_images:[],new_image_resolution:[0,0],canvas:t.canvas,ctx:t,width:0,height:0,ctrl_data:void 0,mouse_pos:[0,0],held_down:!1,next_mode:s(c,"start_mode"),current_mode:i.undefined,task_stack:[],next_update_queued:!1,circumference_thickness:0,render_circle:!1,circle_size:0,show_circle:s(c,"show_circle"),revolve_imgs_on_click:s(c,"revolve_imgs_on_click"),touching:!1,slider_thickness:0,slider_pos:s(c,"start_slider_pos"),slider_time:s(c,"slider_time"),rate_function:s(c,"rate_function"),show_slider:s(c,"show_slider"),start_timestamp:0,start_pos:0,target_pos:0};u(o,a),null!=n&&n(o),$(o,r.change_mode)}))}(e.image_urls,d,e.config,(t=>{var n;null!=e.config&&(null===(n=e.config)||void 0===n?void 0:n.create_controls)&&function(e,t){e.ctrl_data=t,t.circle_check.onclick=g(e,i.circle),t.horizontal_check.onclick=g(e,i.horizontal),t.vertical_check.onclick=g(e,i.vertical),t.revolve_imgs_button.onclick=()=>{$(e,r.revolve_imgs)}}(t,{circle_check:c.current,horizontal_check:a.current,vertical_check:o.current,revolve_imgs_button:l.current}),null!=e.callback&&e.callback(t)}))}),[]),n.default.createElement("div",{style:{display:"flex",flexDirection:"row",width:"100%"}},n.default.createElement("div",null,n.default.createElement("canvas",{style:{width:"100%"},ref:t,tabIndex:1})),null!=e.config&&e.config.create_controls?n.default.createElement("div",{style:{width:"200px"}},n.default.createElement("label",null,n.default.createElement("input",{ref:c,type:"checkbox"}),"Circle"),n.default.createElement("br",null),n.default.createElement("label",null,n.default.createElement("input",{ref:a,type:"checkbox"}),"Horizontal"),n.default.createElement("br",null),n.default.createElement("label",null,n.default.createElement("input",{ref:o,type:"checkbox"}),"Vertical"),n.default.createElement("br",null),n.default.createElement("button",{ref:l},"Revolve Images")):void 0)};var O=c.Z,C=c.t;export{O as default,C as load_new_imgs};