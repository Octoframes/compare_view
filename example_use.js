(()=>{"use strict";var e,t;function n(e){return e.render_circle=!0,document.documentElement.style.cursor="none",!1}function c(e){return l(e,t.update_circle),e.render_circle=!1,document.documentElement.style.cursor="default",!0}function a(e,t,n,c){var a;e.ctx.beginPath(),e.ctx.arc(e.circle_pos[0],e.circle_pos[1],e.circle_size,n,c),e.ctx.lineTo(e.circle_pos[0],e.circle_pos[1]),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(a=e.images[t])||void 0===a?void 0:a.element,0,0,e.width,e.height),e.ctx.restore()}function r(e){return e.images.unshift(e.images.pop()),!0}function o(n){switch(n.current_mode){case e.undefined:break;case e.circle:!function(e){e.canvas.onmouseenter=null,e.canvas.onmousemove=null,e.canvas.onmouseleave=null,e.canvas.onclick=null,document.documentElement.style.cursor="default",u(e,t.remove_circle)}(n);break;case e.horizontal:break;default:throw`unsupported mode: ${n.current_mode}`}switch(n.next_mode){case e.circle:!function(e){e.canvas.onmousemove=n=>{e.circle_pos=[n.offsetX,n.offsetY],u(e,t.update_circle)},e.canvas.onmouseleave=()=>{u(e,t.remove_circle)},e.canvas.onclick=()=>{u(e,t.rotate_imgs)},e.canvas.matches(":hover")&&u(e,t.update_circle)}(n);break;case e.horizontal:break;default:throw`unsupported mode: ${n.current_mode}`}return n.current_mode=n.next_mode,!0}function i(l,u){let s=[];for(;l.task_stack.length;){let e,a=l.task_stack.pop();switch(a){case t.none:e=!0;break;case t.change_mode:e=o(l);break;case t.rotate_imgs:e=r(l);break;case t.update_circle:e=n(l);break;case t.remove_circle:e=c(l);break;default:throw`unknown task: ${a}`}e||s.push(a)}l.task_stack=s,function(t,n){switch(t.current_mode){case e.undefined:break;case e.circle:!function(e,t){var n,c;if(e.render_circle){e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(n=e.images[0])||void 0===n?void 0:n.element,0,0,e.width,e.height);for(let t=1;t<e.images_len;++t)a(e,t,(t-1)*Math.PI*2/(e.images_len-1),t*Math.PI*2/(e.images_len-1))}else e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(c=e.images[0])||void 0===c?void 0:c.element,0,0,e.width,e.height)}(t);break;default:throw`unsupported mode: ${t.current_mode}`}}(l),l.task_stack.length?(window.requestAnimationFrame((e=>{i(l)})),l.next_update_queued=!0):l.next_update_queued=!1}function l(e,t){let n=e.task_stack.indexOf(t);-1!=n&&e.task_stack.splice(n,1)}function u(e,t){l(e,t),e.task_stack.push(t),function(e){e.next_update_queued||(e.next_update_queued=!0,window.requestAnimationFrame((t=>{i(e)})))}(e)}function s(e,t){let n=document.createElement("input");n.type="checkbox",n.id=`${t}circle_button`;let c=document.createElement("label");c.innerHTML="Circle",c.htmlFor=n.id;let a=document.createElement("input");a.type="checkbox",a.id=`${t}horizontal_button`;let r=document.createElement("label");return r.innerHTML="Horizontal",r.htmlFor=a.id,{circle_button:n,horizontal_button:a}}!function(e){e[void 0]="undefined",e.horizontal="horizontal",e.vertical="vertical",e.circle="circle"}(e||(e={})),function(e){e.none="none",e.rotate_imgs="rotate_imgs",e.change_mode="change_mode",e.update_circle="update_circle",e.remove_circle="stop_update_circle"}(t||(t={})),function(n,c,a,r,o){let i=function(e){let t=document.getElementById("canvas"),n=t.getContext("2d");return t.width=t.scrollWidth,t.height=t.scrollHeight,n}();!function(e,t){let n=[],c=0,a=e.length;for(let r=0;r<a;++r){let o={url:e[r],element:document.createElement("img"),label:`${r}`};n.push(o),o.element.onload=()=>{++c,c==a&&t(n)},o.element.src=o.url}}(["./marking_images/1.png","./marking_images/2.png","./marking_images/10.png"],(n=>{u({images:n,images_len:n.length,canvas:i.canvas,ctx:i,width:i.canvas.width,height:i.canvas.height,control_data:s(0,"test_key"),next_mode:r,current_mode:e.undefined,task_stack:[],next_update_queued:!1,render_circle:!1,circle_pos:[0,0],circle_size:200},t.change_mode)}))}(0,0,0,e.circle)})();