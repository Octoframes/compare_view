(()=>{"use strict";var e,t;function n(e,t,n){let a=document.createElement("input");a.type="checkbox",a.id=e;let o=document.createElement("label");o.innerHTML=t,o.htmlFor=a.id;let c=document.createElement("br");return n.appendChild(a),n.appendChild(o),n.appendChild(c),a}function a(e,t){let n=document.createElement("button");n.innerHTML="Rotate Images";let a=document.createElement("br");return t.appendChild(n),t.appendChild(a),n}function o(e,t){let o=document.getElementById(e);return{controls_parent:o,circle_button:n(`${t}circle_button`,"Circle",o),horizontal_button:n(`${t}horizontal_button`,"Horizontal",o),vertical_button:n(`${t}vertical_button`,"Vertical",o),rotate_imgs_button:a(0,o)}}function c(t){var n;switch((n=t.ctrl_data).circle_button.checked=!1,n.horizontal_button.checked=!1,n.vertical_button.checked=!1,t.current_mode){case e.circle:t.ctrl_data.circle_button.checked=!0;break;case e.horizontal:t.ctrl_data.horizontal_button.checked=!0;break;case e.vertical:t.ctrl_data.vertical_button.checked=!0;break;default:throw`unsupported mode: ${t.current_mode}`}}function r(e,n,a){n.onchange=()=>{n.checked?(e.next_mode=a,w(e,t.change_mode)):c(e)}}function i(e,t){let n=e.canvas.getBoundingClientRect(),a=e.width/n.width,o=e.height/n.height;e.mouse_pos=[(t.clientX-n.left)*a,(t.clientY-n.top)*o]}function s(e){return e.render_circle=!0,document.documentElement.style.cursor="none",!1}function l(e){return k(e,t.update_circle),document.documentElement.style.cursor="default",!0}function u(e,t,n,a){var o;e.ctx.beginPath(),e.ctx.arc(e.mouse_pos[0],e.mouse_pos[1],e.circle_size,n,a),e.ctx.lineTo(e.mouse_pos[0],e.mouse_pos[1]),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(o=e.images[t])||void 0===o?void 0:o.element,0,0,e.width,e.height),e.ctx.restore()}function d(n,a){return w(n,t.update_slider),n.start_timestamp=a,n.target_timestamp=a+n.slider_time,n.start_pos=n.slider_pos,n.current_mode==e.horizontal?n.target_pos=n.mouse_pos[0]/n.width:n.target_pos=n.mouse_pos[1]/n.height,!0}function _(t,n){return t.held_down&&(t.current_mode==e.horizontal?t.target_pos=t.mouse_pos[0]/t.width:t.target_pos=t.mouse_pos[1]/t.height,t.start_pos=t.target_pos,t.target_timestamp=n,t.start_timestamp=n,t.slider_pos=t.target_pos),!0}function m(e,t){let n=e.target_timestamp-e.start_timestamp,a=t-e.start_timestamp;if(0==n)return e.slider_pos=e.target_pos,!0;let o=a/n;return o=Math.min(Math.max(o,0),1),o=e.rate_function(o),e.slider_pos=(1-o)*e.start_pos+o*e.target_pos,1==o}function h(e){return e.images.unshift(e.images.pop()),!0}function p(n){switch(n.current_mode){case e.undefined:break;case e.circle:!function(e){e.canvas.onmouseenter=null,e.canvas.onmousemove=null,e.canvas.onmouseleave=null,e.canvas.onmousedown=null,document.documentElement.style.cursor="default",w(e,t.remove_circle)}(n);break;case e.horizontal:case e.vertical:!function(e){e.canvas.onmousedown=null,e.canvas.onmouseup=null,e.canvas.onmouseleave=null,e.canvas.onmousemove=null}(n);break;default:throw`unsupported mode: ${n.current_mode}`}switch(n.next_mode){case e.circle:!function(e){e.canvas.onmousemove=n=>{i(e,n),w(e,t.update_circle)},e.canvas.onmouseleave=()=>{w(e,t.remove_circle)},e.canvas.onmousedown=()=>{w(e,t.rotate_imgs)},e.canvas.matches(":hover")&&w(e,t.update_circle)}(n);break;case e.horizontal:case e.vertical:!function(e){e.canvas.onmousedown=()=>{e.held_down=!0,w(e,t.start_slider_move)},e.canvas.onmouseup=()=>{e.held_down=!1},e.canvas.onmouseleave=()=>{e.held_down=!1},e.canvas.onmousemove=n=>{i(e,n),w(e,t.possible_instant_slide)}}(n);break;default:throw`unsupported mode: ${n.current_mode}`}return n.current_mode=n.next_mode,c(n),!0}function g(t,n){switch(t.current_mode){case e.undefined:break;case e.circle:!function(e){var t,n;if(e.render_circle){e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(t=e.images[0])||void 0===t?void 0:t.element,0,0,e.width,e.height);for(let t=1;t<e.images_len;++t)u(e,t,(t-1)*Math.PI*2/(e.images_len-1),t*Math.PI*2/(e.images_len-1))}else e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(n=e.images[0])||void 0===n?void 0:n.element,0,0,e.width,e.height);e.render_circle=!1}(t);break;case e.horizontal:case e.vertical:!function(t){var n,a;console.log("render"),t.ctx.clearRect(0,0,t.width,t.height),t.ctx.drawImage(null===(n=t.images[0])||void 0===n?void 0:n.element,0,0,t.width,t.height),t.ctx.beginPath(),t.current_mode==e.horizontal?t.ctx.rect(t.slider_pos*t.width,0,t.width,t.height):t.ctx.rect(0,t.slider_pos*t.height,t.width,t.height),t.ctx.closePath(),t.ctx.save(),t.ctx.clip(),t.ctx.drawImage(null===(a=t.images[1])||void 0===a?void 0:a.element,0,0,t.width,t.height),t.ctx.restore()}(t);break;default:throw`unsupported mode: ${t.current_mode}`}}function v(e,n){let a=[];for(;e.task_stack.length;){let o,c=e.task_stack.pop();switch(c){case t.none:o=!0;break;case t.change_mode:o=p(e);break;case t.rotate_imgs:o=h(e);break;case t.update_circle:o=s(e);break;case t.remove_circle:o=l(e);break;case t.start_slider_move:o=d(e,n);break;case t.possible_instant_slide:o=_(e,n);break;case t.update_slider:o=m(e,n);break;default:throw`unknown task: ${c}`}o||a.push(c)}e.task_stack=a,g(e),e.task_stack.length?(window.requestAnimationFrame((t=>{v(e,t)})),e.next_update_queued=!0):e.next_update_queued=!1}function f(e){e.next_update_queued||(e.next_update_queued=!0,window.requestAnimationFrame((t=>{v(e,t)})))}function k(e,t){let n=e.task_stack.indexOf(t);-1!=n&&e.task_stack.splice(n,1)}function w(e,t){k(e,t),e.task_stack.push(t),f(e)}!function(e){e[void 0]="undefined",e.horizontal="horizontal",e.vertical="vertical",e.circle="circle"}(e||(e={})),function(e){e.none="none",e.rotate_imgs="rotate_imgs",e.change_mode="change_mode",e.update_circle="update_circle",e.remove_circle="stop_update_circle",e.start_slider_move="start_slider_move",e.possible_instant_slide="instant_slide",e.update_slider="update_slider"}(t||(t={})),function(n,a,c,i,s){function l(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}let u=function(e){let t=document.getElementById("canvas"),n=t.getContext("2d");return t.width=t.scrollWidth,t.height=t.scrollHeight,n}();!function(e,t){let n=[],a=0,o=e.length;for(let c=0;c<o;++c){let r={url:e[c],element:document.createElement("img"),label:`${c}`};n.push(r),r.element.onload=()=>{++a,a==o&&t(n)},r.element.src=r.url}}(["./marking_images/1.png","./marking_images/2.png","./marking_images/10.png"],(n=>{let a={images:n,images_len:n.length,canvas:u.canvas,ctx:u,width:u.canvas.width,height:u.canvas.height,ctrl_data:o("controls","test_key"),next_mode:i,current_mode:e.undefined,task_stack:[],next_update_queued:!1,mouse_pos:[0,0],held_down:!1,render_circle:!1,circle_size:100,slider_pos:.5,slider_time:400,rate_function:l,start_timestamp:0,target_timestamp:0,start_pos:0,target_pos:0};!function(n){r(n,n.ctrl_data.circle_button,e.circle),r(n,n.ctrl_data.horizontal_button,e.horizontal),r(n,n.ctrl_data.vertical_button,e.vertical),n.ctrl_data.rotate_imgs_button.onclick=()=>{w(n,t.rotate_imgs)}}(a),w(a,t.change_mode)}))}(0,0,0,e.horizontal)})();