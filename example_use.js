(()=>{"use strict";var e,t;function c(e,t,c){let n=document.createElement("input");n.type="checkbox",n.id=e;let a=document.createElement("label");a.innerHTML=t,a.htmlFor=n.id;let o=document.createElement("br");return c.appendChild(n),c.appendChild(a),c.appendChild(o),n}function n(e,t){let c=document.createElement("button");c.innerHTML="Rotate Images";let n=document.createElement("br");return t.appendChild(c),t.appendChild(n),c}function a(e,t){let a=document.getElementById(e);return{controls_parent:a,circle_button:c(`${t}circle_button`,"Circle",a),horizontal_button:c(`${t}horizontal_button`,"Horizontal",a),rotate_imgs_button:n(0,a)}}function o(t){var c;switch((c=t.ctrl_data).circle_button.checked=!1,c.horizontal_button.checked=!1,t.current_mode){case e.circle:t.ctrl_data.circle_button.checked=!0;break;case e.horizontal:t.ctrl_data.horizontal_button.checked=!0;break;default:throw`unsupported mode: ${t.current_mode}`}}function r(e,c,n){c.onchange=()=>{c.checked?(e.next_mode=n,h(e,t.change_mode)):o(e)}}function i(e){return e.render_circle=!0,document.documentElement.style.cursor="none",!1}function l(e){return _(e,t.update_circle),e.render_circle=!1,document.documentElement.style.cursor="default",!0}function u(e,t,c,n){var a;e.ctx.beginPath(),e.ctx.arc(e.circle_pos[0],e.circle_pos[1],e.circle_size,c,n),e.ctx.lineTo(e.circle_pos[0],e.circle_pos[1]),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(a=e.images[t])||void 0===a?void 0:a.element,0,0,e.width,e.height),e.ctx.restore()}function d(e){return e.images.unshift(e.images.pop()),!0}function s(c){switch(c.current_mode){case e.undefined:break;case e.circle:!function(e){e.canvas.onmouseenter=null,e.canvas.onmousemove=null,e.canvas.onmouseleave=null,e.canvas.onclick=null,document.documentElement.style.cursor="default",h(e,t.remove_circle)}(c);break;case e.horizontal:break;default:throw`unsupported mode: ${c.current_mode}`}switch(c.next_mode){case e.circle:!function(e){e.canvas.onmousemove=c=>{e.circle_pos=[c.offsetX,c.offsetY],h(e,t.update_circle)},e.canvas.onmouseleave=()=>{h(e,t.remove_circle)},e.canvas.onclick=()=>{h(e,t.rotate_imgs)},e.canvas.matches(":hover")&&h(e,t.update_circle)}(c);break;case e.horizontal:!function(e){e.canvas.onclick=c=>{e.horizontal_pos=c.offsetX,h(e,t.update_horizontal)}}(c);break;default:throw`unsupported mode: ${c.current_mode}`}return c.current_mode=c.next_mode,o(c),!0}function m(c,n){let a=[];for(;c.task_stack.length;){let e,n=c.task_stack.pop();switch(n){case t.none:e=!0;break;case t.change_mode:e=s(c);break;case t.rotate_imgs:e=d(c);break;case t.update_circle:e=i(c);break;case t.remove_circle:e=l(c);break;case t.update_horizontal:e=!0;break;default:throw`unknown task: ${n}`}e||a.push(n)}c.task_stack=a,function(t,c){switch(t.current_mode){case e.undefined:break;case e.circle:!function(e,t){var c,n;if(e.render_circle){e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(c=e.images[0])||void 0===c?void 0:c.element,0,0,e.width,e.height);for(let t=1;t<e.images_len;++t)u(e,t,(t-1)*Math.PI*2/(e.images_len-1),t*Math.PI*2/(e.images_len-1))}else e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(n=e.images[0])||void 0===n?void 0:n.element,0,0,e.width,e.height)}(t);break;case e.horizontal:!function(e,t){var c,n;e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(c=e.images[0])||void 0===c?void 0:c.element,0,0,e.width,e.height),e.ctx.beginPath(),e.ctx.rect(e.horizontal_pos,0,e.width,e.height),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(n=e.images[1])||void 0===n?void 0:n.element,0,0,e.width,e.height),e.ctx.restore()}(t);break;default:throw`unsupported mode: ${t.current_mode}`}}(c),c.task_stack.length?(window.requestAnimationFrame((e=>{m(c)})),c.next_update_queued=!0):c.next_update_queued=!1}function _(e,t){let c=e.task_stack.indexOf(t);-1!=c&&e.task_stack.splice(c,1)}function h(e,t){_(e,t),e.task_stack.push(t),function(e){e.next_update_queued||(e.next_update_queued=!0,window.requestAnimationFrame((t=>{m(e)})))}(e)}!function(e){e[void 0]="undefined",e.horizontal="horizontal",e.vertical="vertical",e.circle="circle"}(e||(e={})),function(e){e.none="none",e.rotate_imgs="rotate_imgs",e.change_mode="change_mode",e.update_circle="update_circle",e.remove_circle="stop_update_circle",e.update_horizontal="update_horizontal"}(t||(t={})),function(c,n,o,i,l){let u=function(e){let t=document.getElementById("canvas"),c=t.getContext("2d");return t.width=t.scrollWidth,t.height=t.scrollHeight,c}();!function(e,t){let c=[],n=0,a=e.length;for(let o=0;o<a;++o){let r={url:e[o],element:document.createElement("img"),label:`${o}`};c.push(r),r.element.onload=()=>{++n,n==a&&t(c)},r.element.src=r.url}}(["./marking_images/1.png","./marking_images/2.png","./marking_images/10.png"],(c=>{let n={images:c,images_len:c.length,canvas:u.canvas,ctx:u,width:u.canvas.width,height:u.canvas.height,ctrl_data:a("controls","test_key"),next_mode:i,current_mode:e.undefined,task_stack:[],next_update_queued:!1,render_circle:!1,circle_pos:[0,0],circle_size:200,horizontal_pos:0};!function(c){r(c,c.ctrl_data.circle_button,e.circle),r(c,c.ctrl_data.horizontal_button,e.horizontal),c.ctrl_data.rotate_imgs_button.onclick=()=>{h(c,t.rotate_imgs)}}(n),h(n,t.change_mode)}))}(0,0,0,e.circle)})();