(()=>{"use strict";var e,t;function n(e,t,n){let o=document.createElement("input");o.type="checkbox",o.id=e;let a=document.createElement("label");a.innerHTML=t,a.htmlFor=o.id;let c=document.createElement("br");return n.appendChild(o),n.appendChild(a),n.appendChild(c),o}function o(e,t){let n=document.createElement("button");n.innerHTML="Rotate Images";let o=document.createElement("br");return t.appendChild(n),t.appendChild(o),n}function a(e,t){let a=document.getElementById(e);return{controls_parent:a,circle_button:n(`${t}circle_button`,"Circle",a),horizontal_button:n(`${t}horizontal_button`,"Horizontal",a),rotate_imgs_button:o(0,a)}}function c(t){var n;switch((n=t.ctrl_data).circle_button.checked=!1,n.horizontal_button.checked=!1,t.current_mode){case e.circle:t.ctrl_data.circle_button.checked=!0;break;case e.horizontal:t.ctrl_data.horizontal_button.checked=!0;break;default:throw`unsupported mode: ${t.current_mode}`}}function r(e,n,o){n.onchange=()=>{n.checked?(e.next_mode=o,g(e,t.change_mode)):c(e)}}function i(e){return e.render_circle=!0,document.documentElement.style.cursor="none",!1}function l(e){return p(e,t.update_circle),e.render_circle=!1,document.documentElement.style.cursor="default",!0}function u(e,t,n,o){var a;e.ctx.beginPath(),e.ctx.arc(e.mouse_pos[0],e.mouse_pos[1],e.circle_size,n,o),e.ctx.lineTo(e.mouse_pos[0],e.mouse_pos[1]),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(a=e.images[t])||void 0===a?void 0:a.element,0,0,e.width,e.height),e.ctx.restore()}function s(e){return e.horizontal_pos=e.mouse_pos[0],!1}function d(e){return p(e,t.update_horizontal),!0}function m(e){return e.images.unshift(e.images.pop()),!0}function _(n){switch(n.current_mode){case e.undefined:break;case e.circle:!function(e){e.canvas.onmouseenter=null,e.canvas.onmousemove=null,e.canvas.onmouseleave=null,e.canvas.onmousedown=null,document.documentElement.style.cursor="default",g(e,t.remove_circle)}(n);break;case e.horizontal:!function(e){e.canvas.onmousedown=null,e.canvas.onmouseup=null,e.canvas.onmouseleave=null,e.canvas.onmousemove=null}(n);break;default:throw`unsupported mode: ${n.current_mode}`}switch(n.next_mode){case e.circle:!function(e){e.canvas.onmousemove=n=>{e.mouse_pos=[n.offsetX,n.offsetY],g(e,t.update_circle)},e.canvas.onmouseleave=()=>{g(e,t.remove_circle)},e.canvas.onmousedown=()=>{g(e,t.rotate_imgs)},e.canvas.matches(":hover")&&g(e,t.update_circle)}(n);break;case e.horizontal:!function(e){e.canvas.onmousedown=()=>{g(e,t.update_horizontal)},e.canvas.onmouseup=()=>{g(e,t.stop_horizontal)},e.canvas.onmouseleave=()=>{g(e,t.stop_horizontal)},e.canvas.onmousemove=t=>{e.mouse_pos=[t.offsetX,t.offsetY]}}(n);break;default:throw`unsupported mode: ${n.current_mode}`}return n.current_mode=n.next_mode,c(n),!0}function h(n,o){let a=[];for(;n.task_stack.length;){let e,o=n.task_stack.pop();switch(o){case t.none:e=!0;break;case t.change_mode:e=_(n);break;case t.rotate_imgs:e=m(n);break;case t.update_circle:e=i(n);break;case t.remove_circle:e=l(n);break;case t.update_horizontal:e=s(n);break;case t.stop_horizontal:e=d(n);break;default:throw`unknown task: ${o}`}e||a.push(o)}n.task_stack=a,function(t,n){switch(t.current_mode){case e.undefined:break;case e.circle:!function(e,t){var n,o;if(e.render_circle){e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(n=e.images[0])||void 0===n?void 0:n.element,0,0,e.width,e.height);for(let t=1;t<e.images_len;++t)u(e,t,(t-1)*Math.PI*2/(e.images_len-1),t*Math.PI*2/(e.images_len-1))}else e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(o=e.images[0])||void 0===o?void 0:o.element,0,0,e.width,e.height)}(t);break;case e.horizontal:!function(e,t){var n,o;e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(n=e.images[0])||void 0===n?void 0:n.element,0,0,e.width,e.height),e.ctx.beginPath(),e.ctx.rect(e.horizontal_pos,0,e.width,e.height),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(o=e.images[1])||void 0===o?void 0:o.element,0,0,e.width,e.height),e.ctx.restore()}(t);break;default:throw`unsupported mode: ${t.current_mode}`}}(n),n.task_stack.length?(window.requestAnimationFrame((e=>{h(n)})),n.next_update_queued=!0):n.next_update_queued=!1}function p(e,t){let n=e.task_stack.indexOf(t);-1!=n&&e.task_stack.splice(n,1)}function g(e,t){p(e,t),e.task_stack.push(t),function(e){e.next_update_queued||(e.next_update_queued=!0,window.requestAnimationFrame((t=>{h(e)})))}(e)}!function(e){e[void 0]="undefined",e.horizontal="horizontal",e.vertical="vertical",e.circle="circle"}(e||(e={})),function(e){e.none="none",e.rotate_imgs="rotate_imgs",e.change_mode="change_mode",e.update_circle="update_circle",e.remove_circle="stop_update_circle",e.update_horizontal="update_horizontal",e.stop_horizontal="stop_horizontal"}(t||(t={})),function(n,o,c,i,l){let u=function(e){let t=document.getElementById("canvas"),n=t.getContext("2d");return t.width=t.scrollWidth,t.height=t.scrollHeight,n}();!function(e,t){let n=[],o=0,a=e.length;for(let c=0;c<a;++c){let r={url:e[c],element:document.createElement("img"),label:`${c}`};n.push(r),r.element.onload=()=>{++o,o==a&&t(n)},r.element.src=r.url}}(["./marking_images/1.png","./marking_images/2.png","./marking_images/10.png"],(n=>{let o={images:n,images_len:n.length,canvas:u.canvas,ctx:u,width:u.canvas.width,height:u.canvas.height,ctrl_data:a("controls","test_key"),next_mode:i,current_mode:e.undefined,task_stack:[],next_update_queued:!1,mouse_pos:[0,0],render_circle:!1,circle_size:200,horizontal_pos:0};!function(n){r(n,n.ctrl_data.circle_button,e.circle),r(n,n.ctrl_data.horizontal_button,e.horizontal),n.ctrl_data.rotate_imgs_button.onclick=()=>{g(n,t.rotate_imgs)}}(o),g(o,t.change_mode)}))}(0,0,0,e.horizontal)})();