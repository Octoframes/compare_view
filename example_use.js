(()=>{"use strict";var e,t;function n(e,t,n){let a=document.createElement("input");a.type="checkbox",a.id=e;let c=document.createElement("label");c.innerHTML=t,c.htmlFor=a.id;let r=document.createElement("br");return n.appendChild(a),n.appendChild(c),n.appendChild(r),a}function a(e,t){let n=document.createElement("button");n.innerHTML="Rotate Images";let a=document.createElement("br");return t.appendChild(n),t.appendChild(a),n}function c(e,t){let c=document.getElementById(e);return{controls_parent:c,circle_button:n(`${t}circle_button`,"Circle",c),slider_button:n(`${t}slider_button`,"Slider",c),rotate_imgs_button:a(0,c)}}function r(t){var n;switch((n=t.ctrl_data).circle_button.checked=!1,n.slider_button.checked=!1,t.current_mode){case e.circle:t.ctrl_data.circle_button.checked=!0;break;case e.slider:t.ctrl_data.slider_button.checked=!0;break;default:throw`unsupported mode: ${t.current_mode}`}}function s(e,n,a){n.onchange=()=>{n.checked?(e.next_mode=a,f(e,t.change_mode)):r(e)}}function o(e){return e.render_circle=!0,document.documentElement.style.cursor="none",!1}function i(e){return v(e,t.update_circle),document.documentElement.style.cursor="default",!0}function l(e,t,n,a){var c;e.ctx.beginPath(),e.ctx.arc(e.mouse_pos[0],e.mouse_pos[1],e.circle_size,n,a),e.ctx.lineTo(e.mouse_pos[0],e.mouse_pos[1]),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(c=e.images[t])||void 0===c?void 0:c.element,0,0,e.width,e.height),e.ctx.restore()}function d(e,n){return f(e,t.update_slider),e.start_timestamp=n,e.target_timestamp=n+e.slider_time,e.start_pos=e.slider_pos,e.target_pos=e.mouse_pos[0],!0}function u(e){return function(e,t){return-1!=e.task_stack.indexOf(t)}(e,t.update_slider)&&(e.target_pos=e.mouse_pos[0],e.start_pos=e.mouse_pos[0]),!0}function _(e){return e.slider_pos=e.target_pos,!1}function m(e){return v(e,t.start_slider_move),v(e,t.instant_slide),v(e,t.update_slider),!0}function p(e){return e.images.unshift(e.images.pop()),!0}function h(n){switch(n.current_mode){case e.undefined:break;case e.circle:!function(e){e.canvas.onmouseenter=null,e.canvas.onmousemove=null,e.canvas.onmouseleave=null,e.canvas.onmousedown=null,document.documentElement.style.cursor="default",f(e,t.remove_circle)}(n);break;case e.slider:!function(e){e.canvas.onmousedown=null,e.canvas.onmouseup=null,e.canvas.onmouseleave=null,e.canvas.onmousemove=null}(n);break;default:throw`unsupported mode: ${n.current_mode}`}switch(n.next_mode){case e.circle:!function(e){e.canvas.onmousemove=n=>{e.mouse_pos=[n.offsetX,n.offsetY],f(e,t.update_circle)},e.canvas.onmouseleave=()=>{f(e,t.remove_circle)},e.canvas.onmousedown=()=>{f(e,t.rotate_imgs)},e.canvas.matches(":hover")&&f(e,t.update_circle)}(n);break;case e.slider:!function(e){e.canvas.onmousedown=()=>{f(e,t.start_slider_move)},e.canvas.onmouseup=()=>{f(e,t.stop_slider)},e.canvas.onmouseleave=()=>{f(e,t.stop_slider)},e.canvas.onmousemove=n=>{e.mouse_pos=[n.offsetX,n.offsetY],f(e,t.instant_slide)}}(n);break;default:throw`unsupported mode: ${n.current_mode}`}return n.current_mode=n.next_mode,r(n),!0}function g(n,a){let c=[];for(;n.task_stack.length;){let e,r=n.task_stack.pop();switch(r){case t.none:e=!0;break;case t.change_mode:e=h(n);break;case t.rotate_imgs:e=p(n);break;case t.update_circle:e=o(n);break;case t.remove_circle:e=i(n);break;case t.start_slider_move:e=d(n,a);break;case t.instant_slide:e=u(n);break;case t.update_slider:e=_(n);break;case t.stop_slider:e=m(n);break;default:throw`unknown task: ${r}`}e||c.push(r)}n.task_stack=c,function(t,n){switch(t.current_mode){case e.undefined:break;case e.circle:!function(e,t){var n,a;if(e.render_circle){e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(n=e.images[0])||void 0===n?void 0:n.element,0,0,e.width,e.height);for(let t=1;t<e.images_len;++t)l(e,t,(t-1)*Math.PI*2/(e.images_len-1),t*Math.PI*2/(e.images_len-1))}else e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(a=e.images[0])||void 0===a?void 0:a.element,0,0,e.width,e.height);e.render_circle=!1}(t);break;case e.slider:!function(e,t){var n,a;e.ctx.clearRect(0,0,e.width,e.height),e.ctx.drawImage(null===(n=e.images[0])||void 0===n?void 0:n.element,0,0,e.width,e.height),e.ctx.beginPath(),e.ctx.rect(e.slider_pos,0,e.width,e.height),e.ctx.closePath(),e.ctx.save(),e.ctx.clip(),e.ctx.drawImage(null===(a=e.images[1])||void 0===a?void 0:a.element,0,0,e.width,e.height),e.ctx.restore()}(t);break;default:throw`unsupported mode: ${t.current_mode}`}}(n),n.task_stack.length?(window.requestAnimationFrame((e=>{g(n,e)})),n.next_update_queued=!0):n.next_update_queued=!1}function v(e,t){let n=e.task_stack.indexOf(t);-1!=n&&e.task_stack.splice(n,1)}function f(e,t){v(e,t),e.task_stack.push(t),function(e){e.next_update_queued||(e.next_update_queued=!0,window.requestAnimationFrame((t=>{g(e,t)})))}(e)}!function(e){e[void 0]="undefined",e.slider="slider",e.vertical="vertical",e.circle="circle"}(e||(e={})),function(e){e.none="none",e.rotate_imgs="rotate_imgs",e.change_mode="change_mode",e.update_circle="update_circle",e.remove_circle="stop_update_circle",e.start_slider_move="start_slider_move",e.instant_slide="instant_slide",e.update_slider="update_slider",e.stop_slider="stop_slider"}(t||(t={})),function(n,a,r,o,i){let l=function(e){let t=document.getElementById("canvas"),n=t.getContext("2d");return t.width=t.scrollWidth,t.height=t.scrollHeight,n}();!function(e,t){let n=[],a=0,c=e.length;for(let r=0;r<c;++r){let s={url:e[r],element:document.createElement("img"),label:`${r}`};n.push(s),s.element.onload=()=>{++a,a==c&&t(n)},s.element.src=s.url}}(["./marking_images/1.png","./marking_images/2.png","./marking_images/10.png"],(n=>{let a={images:n,images_len:n.length,canvas:l.canvas,ctx:l,width:l.canvas.width,height:l.canvas.height,ctrl_data:c("controls","test_key"),next_mode:o,current_mode:e.undefined,task_stack:[],next_update_queued:!1,mouse_pos:[0,0],render_circle:!1,circle_size:200,slider_pos:100,slider_time:500,start_timestamp:0,target_timestamp:0,start_pos:0,target_pos:0};!function(n){s(n,n.ctrl_data.circle_button,e.circle),s(n,n.ctrl_data.slider_button,e.slider),n.ctrl_data.rotate_imgs_button.onclick=()=>{f(n,t.rotate_imgs)}}(a),f(a,t.change_mode)}))}(0,0,0,e.slider)})();